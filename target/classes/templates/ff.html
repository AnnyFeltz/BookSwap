<!-- Main Content -->
<main class="site-content">
    <div class="container mt-4">
        <div class="row mb-3">
            <div class="col-md-12"> <a href="/" class="btn btn-outline-secondary"> <i class="fas fa-arrow-left"></i>
                    Voltar para a lista </a> </div>
        </div> <!-- Mensagem de Sucesso -->
        <#if ctx.queryParam("msg")??>
            <#if ctx.queryParam("msg")=="livro_atualizado">
                <div class="alert alert-success alert-dismissible fade show" role="alert"> <i
                        class="fas fa-check-circle"></i> Livro atualizado com sucesso! <button type="button"
                        class="btn-close" data-bs-dismiss="alert" aria-label="Fechar"></button> </div>
            </#if>
        </#if> <!-- Card do Livro -->
        <div class="card shadow-sm mb-5">
            <div class="card-body">
                <div class="row g-4"> <!-- Coluna da Capa -->
                    <div class="col-md-4 text-center"> <img src="${livro.fotoCapa}" class="book-cover"
                            alt="Capa do Livro: ${livro.titulo}">
                        <div class="mt-3"> <span class="h4 text-primary">${livro.precoCreditos?string["0.00"]}
                                Créditos</span> </div>
                        <#if isDono>
                            <div class="mt-3 d-grid gap-2"> <a href="/livro/${livro.id}/editar"
                                    class="btn btn-info btn-lg"> <i class="fas fa-edit"></i> Editar Livro </a> <a
                                    href="#" class="btn btn-danger btn-lg" data-bs-toggle="modal"
                                    data-bs-target="#modalDeletar"> <i class="fas fa-trash-alt"></i> Deletar Livro </a>
                                <small class="text-muted d-block mt-2">Você é o dono deste livro.</small> </div>
                            <#else>
                                <#if livro.statusLivro.name()=="DISPONIVEL"> <button type="button"
                                        class="btn btn-success btn-lg btn-block mt-3" data-bs-toggle="modal"
                                        data-bs-target="#modalTroca"> <i class="fas fa-exchange-alt"></i> TROCAR AGORA
                                    </button> <small class="text-muted d-block mt-2">Seu saldo atual:
                                        <strong>${creditosUsuario?string["0.00"]} Créditos</strong></small>
                                    <#else> <button class="btn btn-secondary btn-lg btn-block mt-3" disabled> <i
                                                class="fas fa-clock"></i> ${livro.statusLivro.name()} </button> <small
                                            class="text-danger d-block mt-2">Este livro não está disponível para troca
                                            no momento.</small>
                                </#if>
                        </#if>
                    </div> <!-- Coluna das Informações -->
                    <div class="col-md-8">
                        <h1 class="display-5 text-primary">${livro.titulo}</h1>
                        <h3 class="text-secondary">Por ${livro.autor}</h3>
                        <hr>
                        <div class="row row-cols-1 row-cols-md-2 g-3 mb-3">
                            <div class="col">
                                <p class="mb-0"> <i class="fas fa-user-circle text-primary me-2"></i> Dono: <a
                                        href="/perfil/${dono.id}"
                                        class="fw-bold text-dark text-decoration-none">${dono.nome}</a>
                                    <#if dono.fotoPerfil??> <img src="${dono.fotoPerfil}" class="rounded-circle ms-2"
                                            style="width:30px; height:30px; object-fit:cover;" alt="Foto do Dono">
                                    </#if>
                                </p>
                            </div>
                            <div class="col">
                                <p class="mb-0"> <i class="fas fa-book-open text-primary me-2"></i> Condição: <span
                                        class="fw-semibold">${livro.condicaoEstado}</span> </p>
                            </div>
                            <div class="col">
                                <p class="mb-0"> <i class="fas fa-sync-alt text-primary me-2"></i> Status: <span
                                        class="badge bg-info">${livro.statusLivro.name()}</span> </p>
                            </div>
                        </div>
                        <h3 class="mt-3 text-primary">Descrição</h3>
                        <div class="p-3 bg-light rounded">
                            <p class="lead">${livro.descricao! "*Descrição não fornecida*"}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div> <!-- Modal Troca -->
    <#if !isDono && livro.statusLivro.name()=="DISPONIVEL">
        <div class="modal fade" id="modalTroca" tabindex="-1" aria-labelledby="modalTrocaLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header bg-success text-white">
                        <h5 class="modal-title" id="modalTrocaLabel"><i class="fas fa-exchange-alt me-2"></i> Confirmar
                            Troca</h5> <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                            aria-label="Fechar"></button>
                    </div>
                    <form action="/troca/iniciar/${livro.id}" method="POST">
                        <div class="modal-body">
                            <p>Você está prestes a adquirir "<strong>${livro.titulo}</strong>" por
                                <strong>${livro.precoCreditos?string["0.00"]} Créditos</strong>.</p>
                            <p>Seu saldo atual: <strong>${creditosUsuario?string["0.00"]} Créditos</strong></p>
                            <#if creditosUsuario < livro.precoCreditos>
                                <div class="alert alert-danger" role="alert"> <i
                                        class="fas fa-exclamation-triangle"></i> Saldo insuficiente! Você precisa de
                                    <strong>${(livro.precoCreditos - creditosUsuario)?string["0.00"]} Créditos</strong>
                                    a mais. </div> <button type="submit" class="btn btn-success w-100"
                                    disabled>TROCAR</button>
                                <#else>
                                    <div class="alert alert-info" role="alert"> <i class="fas fa-info-circle"></i> Ao
                                        confirmar, ${livro.precoCreditos?string["0.00"]} Créditos serão debitados.
                                    </div>
                                    <div class="mb-3"> <label for="idLivroOfertado" class="form-label fw-bold">Selecione
                                            seu livro para oferta (Opcional):</label> <select class="form-select"
                                            id="idLivroOfertado" name="idLivroOfertado">
                                            <option value="">-- Não ofertar livro (Apenas créditos) --</option>
                                            <#if meusLivrosDisponiveis?? && (meusLivrosDisponiveis?size> 0)> <#list
                                                    meusLivrosDisponiveis as meuLivro>
                                                    <#if meuLivro.id !=livro.id>
                                                        <option value="${meuLivro.id}">${meuLivro.titulo}
                                                            (${meuLivro.condicaoEstado})</option>
                                                    </#if>
                                                </#list>
                                                <#else>
                                                    <option value="" disabled>Você não tem livros disponíveis para
                                                        oferta.</option>
                                            </#if>
                                        </select> </div>
                                    <div class="modal-footer px-0 pb-0"> <button type="button" class="btn btn-secondary"
                                            data-bs-dismiss="modal">Cancelar</button> <button type="submit"
                                            class="btn btn-success"> <i class="fas fa-share-square"></i> Enviar Proposta
                                            de Troca </button> </div>
                            </#if>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </#if> <!-- Modal Deletar -->
    <#if isDono>
        <div class="modal fade" id="modalDeletar" tabindex="-1" aria-labelledby="modalDeletarLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header bg-danger text-white">
                        <h5 class="modal-title" id="modalDeletarLabel"><i class="fas fa-trash-alt me-2"></i> Confirmar
                            Deleção</h5> <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                            aria-label="Fechar"></button>
                    </div>
                    <div class="modal-body">
                        <p>Tem certeza que deseja deletar o livro "<strong>${livro.titulo}</strong>"?</p>
                        <div class="alert alert-warning">Esta ação é irreversível.</div>
                    </div>
                    <div class="modal-footer"> <button type="button" class="btn btn-secondary"
                            data-bs-dismiss="modal">Cancelar</button> <a href="/livro/${livro.id}/deletar"
                            class="btn btn-danger"> <i class="fas fa-trash-alt"></i> Deletar Permanentemente </a> </div>
                </div>
            </div>
        </div>
    </#if>
</main> <!-- Footer -->
<footer class="site-footer bg-light text-center py-3 mt-5">
    <p class="mb-0">&copy; 2025 BookSwap. Todos os direitos reservados.</p>
</footer> <!-- Scripts Bootstrap 5 Bundle (Inclui Popper) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+0F5M5nLD69Npy4HI+N/1N9+78/3D"
    crossorigin="anonymous"></script>
</body>

</html>